#!/bin/bash

OUTPUT_DIR="pokemon_data"
CSV_FILE="pokemon_report.csv"

if [ ! -d "$OUTPUT_DIR" ]; then
    echo "Error: $OUTPUT_DIR directory not found. Please run batchProcessing-0x02 first."
    exit 1
fi

echo "CSV Report generated at: $CSV_FILE"
echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

declare -a heights
declare -a weights
count=0

for json_file in "$OUTPUT_DIR"/*.json; do
    if [ -f "$json_file" ]; then
        name=$(jq -r '.name' "$json_file" | awk '{print toupper(substr($0,1,1)) tolower(substr($0,2))}' | sed 's/.*/\u&/')
        height=$(jq -r '.height' "$json_file" | awk '{printf "%.1f", $1/10}')
        weight=$(jq -r '.weight' "$json_file" | awk '{printf "%.1f", $1/10}')
        
        echo "$name,$height,$weight" >> "$CSV_FILE"
        
        heights[count]=$height
        weights[count]=$weight
        ((count++))
    fi
done

cat "$CSV_FILE"

if [ $count -gt 0 ]; then
    avg_height=$(printf '%s\n' "${heights[@]}" | awk '{sum += $1; count++} END {if (count > 0) printf "%.2f", sum/count}')
    avg_weight=$(printf '%s\n' "${weights[@]}" | awk '{sum += $1; count++} END {if (count > 0) printf "%.2f", sum/count}')
    
    echo "Average Height: $avg_height m"
    echo "Average Weight: $avg_weight kg"
else
    echo "No Pokemon data found to calculate averages."
fi