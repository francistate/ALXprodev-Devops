#!/bin/bash

POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
OUTPUT_DIR="pokemon_data"
BASE_URL="https://pokeapi.co/api/v2/pokemon"

mkdir -p "$OUTPUT_DIR"

echo "Starting parallel Pokemon data retrieval..."

fetch_pokemon_parallel() {
    local pokemon=$1
    echo "Fetching data for $pokemon..."
    
    if curl -s -f "$BASE_URL/$pokemon" -o "$OUTPUT_DIR/${pokemon}.json"; then
        echo "Saved data to $OUTPUT_DIR/${pokemon}.json ✅"
    else
        echo "Failed to fetch data for $pokemon ❌"
        echo "$(date): Failed to fetch data for $pokemon" >> errors.txt
    fi
}

declare -a pids=()

for pokemon in "${POKEMON_LIST[@]}"; do
    fetch_pokemon_parallel "$pokemon" &
    pids+=($!)
done

echo "All fetch processes started. Waiting for completion..."
jobs

while [ $(jobs -r | wc -l) -gt 0 ]; do
    sleep 1
    for job in $(jobs -p); do
        if ! kill -0 "$job" 2>/dev/null; then
            wait "$job"
        fi
    done
done

jobs

echo "All parallel processes completed!"
echo "Parallel batch processing complete!"